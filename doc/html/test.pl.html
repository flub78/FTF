
<html>
<head>
<title>test.pl</title>
<meta name="generator" content="perl2html 0.9.2">
<meta name="date" content="2010-10-28T12:18:35+00:00">
</head>

<body bgcolor="#FFFFFF">
<pre width="80"><font color="#B22222"># ------------------------------------------------------------------------</font>
<font color="#B22222"># Title:  Component Test Template</font>
<font color="#B22222">#</font>
<font color="#B22222"># Source - &lt;file:../test.pl.html&gt;</font>
<font color="#B22222"># Version - 1.0</font>
<font color="#B22222">#</font>
<font color="#B22222"># Abstract:</font>
<font color="#B22222">#</font>
<font color="#B22222">#    This is a component test template. It derives from the &lt;Test&gt; class.</font>
<font color="#B22222">#    You can notice how the test description is embedeed in comments</font>
<font color="#B22222">#    to have the test sheets extracted directly from the test with</font>
<font color="#B22222">#    *NaturalDocs*</font>
<font color="#B22222">#</font>
<font color="#B22222">#    See the &lt;Test&gt; and &lt;Script&gt; module documentation for the detail</font>
<font color="#B22222">#    of accepted options.</font>
<font color="#B22222">#</font>
<font color="#B22222"># Test Purpose:</font>
<font color="#B22222">#</font>
<font color="#B22222">#    This test checks the Test class and provides an example</font>
<font color="#B22222">#    to generate tests.</font>
<font color="#B22222">#</font>
<font color="#B22222"># Execution:</font>
<font color="#B22222">#</font>
<font color="#B22222">#    &gt; perl test.pl -v -skip setup</font>
<font color="#B22222">#</font>
<font color="#B22222"># Acceptation criteria:</font>
<font color="#B22222">#</font>
<font color="#B22222">#    It is a self-reporting tests which uses the Test::More Perl</font>
<font color="#B22222">#    module for reporting. If the test fails it is reported on STDOUT.</font>
<font color="#B22222">#</font>
<font color="#B22222"># Usage:</font>
<font color="#B22222"># (Start code)</font>
<font color="#B22222"># Test template.</font>
<font color="#B22222">#</font>
<font color="#B22222"># usage: perl test.pl [options]</font>
<font color="#B22222">#        -verbose         flag    switch on verbose mode.</font>
<font color="#B22222">#        -fail            flag    set to emulate failure</font>
<font color="#B22222">#        -match           array   Keywords, execute the matching parts, (default all)</font>
<font color="#B22222">#        -requirements    array   Requirements covered by the test</font>
<font color="#B22222">#        -directory       string  Logs and result directory</font>
<font color="#B22222">#        -outputDirectory string  directory for outputs</font>
<font color="#B22222">#        -memory          flag    checks the memory usage.</font>
<font color="#B22222">#        -synopsis        string  test short description</font>
<font color="#B22222">#        -skip            array   Keyword, skip the matching parts (default none)</font>
<font color="#B22222">#        -pid             string  pid of the process to monitor</font>
<font color="#B22222">#        -iteration       string  number of test iteration.</font>
<font color="#B22222">#        -help            flag    display the online help.</font>
<font color="#B22222">#        -testId          string  test identificator. (default = script basename)</font>
<font color="#B22222">#        -performance     flag    displays execution time.</font>
<font color="#B22222">#</font>
<font color="#B22222"># Exemple:</font>
<font color="#B22222">#</font>
<font color="#B22222">#    perl test.pl -help</font>
<font color="#B22222">#</font>
<font color="#B22222"># (end)</font>
<font color="#B22222">#</font>
<font color="#B22222"># Output:</font>
<font color="#B22222"># Example of success.</font>
<font color="#B22222"># (start code)</font>
<font color="#B22222"># 2009/07/03 15:02:25 WARN Tests.Checks : PASSED Subtest 1</font>
<font color="#B22222"># 2009/07/03 15:02:25 WARN Tests.Checks : PASSED Subtest 2, fails when required by parameter</font>
<font color="#B22222"># 2009/07/03 15:02:25 WARN Tests.Checks : PASSED Highwatermark =  1440 at 33%</font>
<font color="#B22222"># 2009/07/03 15:02:25 WARN Tests.Checks : PASSED TOTO, success=7, failures=0</font>
<font color="#B22222"># (end)</font>
<font color="#B22222"># ------------------------------------------------------------------------</font>
<font color="#B22222"># To customize: replace the package name</font>
<font color="#4169E1">package ComponentTest;</font>

<font color="#4169E1">use strict;</font>
use lib <font color="#228B22">"</font>$ENV<font color="#228B22">{'FTF'}/lib"</font>;
<font color="#4169E1">use vars qw($VERSION @ISA @EXPORT);</font>
<font color="#4169E1">use Exporter;</font>
<font color="#4169E1">use Test;</font>

$VERSION = 1;
@ISA     = qw(Test);

<font color="#B22222"># To customize: add your own libraries</font>
<font color="#4169E1">use Data::Dumper;</font>
<font color="#4169E1">use ExecutionContext;</font>
<font color="#4169E1">use ScriptConfiguration;</font>

<font color="#B22222"># ------------------------------------------------------------------------</font>
<font color="#B22222"># method: subtest_1</font>
<font color="#B22222">#</font>
<font color="#B22222"># first subtest</font>
<font color="#B22222"># ------------------------------------------------------------------------</font>
<strong><font color="#4169E1">sub subtest_1 </font></strong>{
<font color="#4169E1">    my</font> $Self = shift;

<font color="#B22222">    # First subtest</font>
    $Self-&gt;ok( 1, <font color="#228B22">"Subtest 1"</font> );
}

<font color="#B22222"># ------------------------------------------------------------------------</font>
<font color="#B22222"># method: subtest_2</font>
<font color="#B22222">#</font>
<font color="#B22222"># second subtest</font>
<font color="#B22222"># ------------------------------------------------------------------------</font>
<strong><font color="#4169E1">sub subtest_2 </font></strong>{
<font color="#4169E1">    my</font> $Self      = shift;
<font color="#4169E1">    my</font> $must_fail = $Self-&gt;{<font color="#228B22">'config'</font>}-&gt;value(<font color="#228B22">'fail'</font>);

<font color="#B22222">    # Second subtest</font>
    $Self-&gt;warn(<font color="#228B22">"Subsequent method may fail"</font>);
    $Self-&gt;ok( !$must_fail, <font color="#228B22">"Subtest 2, fails when required by parameter"</font> );
<font color="#4169E1">    if</font> ($must_fail) {
        $Self-&gt;trace(<font color="#228B22">"log at the TRACE level"</font>);
        $Self-&gt;debug(<font color="#228B22">"log at the DEBUG level"</font>);
        $Self-&gt;info(<font color="#228B22">"log at the INFO level"</font>);
        $Self-&gt;warn(<font color="#228B22">"log at the WARN level"</font>);
        $Self-&gt;error(<font color="#228B22">"log at the ERROR level"</font>);
        $Self-&gt;fatal(<font color="#228B22">"log at the FATAL level"</font>);
    }

    eval {
        die <font color="#228B22">"exception raised"</font>;
        $Self-&gt;ok( 0, <font color="#228B22">"expected error not reported"</font> );
    };
<font color="#4169E1">    if</font> ($@) {
        $Self-&gt;ok( 1, <font color="#228B22">"expected error correctly reported: </font>$@<font color="#228B22">"</font> );
    }
}

<font color="#B22222"># ------------------------------------------------------------------------</font>
<font color="#B22222"># method: TestMain</font>
<font color="#B22222">#</font>
<font color="#B22222"># Test main routine. It is this method which is executed several times</font>
<font color="#B22222"># when the *-iteration* parameter is more than 1.</font>
<font color="#B22222"># ------------------------------------------------------------------------</font>
<font color="#B22222"># To customize: replace the test main method</font>
<strong><font color="#4169E1">sub TestMain </font></strong>{
<font color="#4169E1">    my</font> $Self = shift;
<font color="#4169E1">    if</font> ( $Self-&gt;{<font color="#228B22">'scenario'</font>} ) {
<font color="#4169E1">        my</font> $scen = $Self-&gt;{<font color="#228B22">'scenario'</font>};
        ( -f $scen ) or die <font color="#228B22">"scenario </font>$scen<font color="#228B22"> not found"</font>;

<font color="#4169E1">        my</font> $cmd = `cat $scen`;
        eval $cmd;
<font color="#4169E1">        if</font> ($@) {
            $Self-&gt;failed(<font color="#228B22">"Error in scenario </font>$scen<font color="#228B22">: "</font> . $@);
        }
    }
<font color="#4169E1">    else</font> {
        $Self-&gt;info(<font color="#228B22">"</font>TestMain<font color="#228B22">"</font>);

        $Self-&gt;subtest_1();
        $Self-&gt;subtest_2();
    }
}

<font color="#B22222"># ------------------------------------------------------------------------</font>
<font color="#B22222"># On line help and options.</font>
<font color="#B22222"># The full online help is the catenation of the header,</font>
<font color="#B22222"># the parameters description and the footer. Parameters description</font>
<font color="#B22222">#  is automatically computed.</font>

<font color="#B22222"># my $config     = new ScriptConfiguration('scheme'     =&gt; TEST);</font>

<font color="#B22222"># To customize: you can remove help specification, remove the</font>
<font color="#B22222"># configuration file, remove additional parameters and even remove</font>
<font color="#B22222"># everything related to configuration.</font>
<font color="#4169E1">my</font> $help_header = <font color="#228B22">'
Test template. 

usage: perl test.pl [options]'</font>;

<font color="#4169E1">my</font> $help_footer = <font color="#228B22">"
Exemple:

    perl test.pl -help
    perl test.pl -iter 2 -scen scen1.scen
"</font>;

<font color="#B22222"># If you specify a configuration file, it must exist.</font>
<font color="#4169E1">my</font> $configFile = ExecutionContext::configFile();
<font color="#4169E1">my</font> $config     = new ScriptConfiguration(
    <font color="#228B22">'header'</font>     =&gt; $help_header,
    <font color="#228B22">'footer'</font>     =&gt; $help_footer,
    <font color="#228B22">'scheme'</font>     =&gt; TEST,
    <font color="#228B22">'parameters'</font> =&gt; {
        fail =&gt; {
            type        =&gt; <font color="#228B22">"</font>flag<font color="#228B22">"</font>,
            description =&gt; <font color="#228B22">"set to emulate failure"</font>,
            default     =&gt; 0
        },
        scenario =&gt; {
            type        =&gt; <font color="#228B22">"</font>string<font color="#228B22">"</font>,
            description =&gt; <font color="#228B22">"test scenario (subscript)"</font>,
            default     =&gt; <font color="#228B22">""</font>
        }
    },
<font color="#B22222">#    'configFile' =&gt; $configFile</font>
);

<font color="#B22222"># Variable: test</font>
<font color="#B22222"># To customize: replace by your package name</font>
<font color="#4169E1">my</font> $test = new ComponentTest(
    testId       =&gt; $config-&gt;value(<font color="#228B22">'testId'</font>),
    synopsis     =&gt; $config-&gt;value(<font color="#228B22">"</font>synopsis<font color="#228B22">"</font>),
    scenario     =&gt; $config-&gt;value(<font color="#228B22">"</font>scenario<font color="#228B22">"</font>),
    config       =&gt; $config,
    keywords     =&gt; [ <font color="#228B22">'Unix'</font>, <font color="#228B22">'AIX'</font> ],
    requirements =&gt; [ <font color="#228B22">'REQ4'</font>, <font color="#228B22">'REQ6'</font> ],
    loggerName   =&gt; <font color="#228B22">"</font>Test<font color="#228B22">"</font>,
    iteration    =&gt; $config-&gt;value(<font color="#228B22">'iteration'</font>),
    match        =&gt; $config-&gt;value(<font color="#228B22">'match'</font>),
    skip         =&gt; $config-&gt;value(<font color="#228B22">'skip'</font>),
    memory       =&gt; $config-&gt;value(<font color="#228B22">'memory'</font>),
    pid          =&gt; $config-&gt;value(<font color="#228B22">'pid'</font>),
    performance  =&gt; $config-&gt;value(<font color="#228B22">'performance'</font>)
);

<font color="#B22222"># Add additional requirements from CLI (remove if useless)</font>
$test-&gt;requirements( $config-&gt;value(<font color="#228B22">'requirements'</font>) );
$test-&gt;requirements( [<font color="#228B22">'REQ4'</font>] );

<font color="#B22222"># To customize: replace by your test documentation</font>
$test-&gt;doc(<font color="#228B22">"TestId = </font>$test<font color="#228B22">-&gt;{'testId'}"</font>);
$test-&gt;doc(<font color="#228B22">"This test checks that the software works."</font>);
$test-&gt;doc(<font color="#228B22">""</font>);
$test-&gt;doc(<font color="#228B22">"The programs is started, then several data sets are submitted."</font>);
$test-&gt;doc(<font color="#228B22">"Each outputs are checks for conformity."</font>);
$test-&gt;doc(<font color="#228B22">""</font>);
$test-&gt;doc(<font color="#228B22">"AcceptationCriteria, this is a self reporting test"</font>);
$test-&gt;doc(<font color="#228B22">""</font>);

exit($test-&gt;run());

</pre>
</body>

</html>
